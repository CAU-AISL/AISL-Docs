# 1회차

---

# 23.07.07

```arduino
ledcAttachPin(uint8_t pin, uint8_t channel);
ledcSetup(uint8_t channel, double freq, uint8_t resolution_bits);
ledcWrite(uint8_t channel, uint32_t duty);
```

- `ledcAttachPin(pin, channel);`
    - 제어할 핀과 채널을 연결
- `ledcSetup(channel, freq, resolution_bits);`
    - 하드웨어 PWM을 구현하기 위한 명령어
    - `frequency`는 PWM의 `HIGH, LOW` 신호를 얼마나 짧게 설정할 것인지
    즉 신호의 분해능을 얼마만큼 설정할 것인지
    - `resolution_bit`은 출력을 얼마만큼 분해해 표현할 것인지
- `ledcWrite(channel, duty);`
    - 할당한 채널에 출력을 얼마만큼 줄 것인지
        - 아두이노의 `analogWrite()`와 똑같다고 생각하면 됩니다.
    - `duty`엔 resolution에 해당하는 값 범위 안에서 설정하면 됨.

```arduino
#define FAN_PIN 19
#define FAN_CHANNEL 1
#define FAN_RESOLUTION = 10

int melody[] = { 262, 294, 330, 349, 393, 440, 494, 523 };

void setup() {
  ledcAttachPin(FAN_PIN, FAN_CHANNEL);

  for (int note = 0; note < 8; note += 1) {
    ledcSetup(FAN_CHANNEL, melody[note], FAN_RESOLUTION);
    ledcWrite(FAN_CHANNEL, 10);

    delay(500);
  }

  ledcWrite(FAN_CHANNEL, 0);
}

void loop(){
  
}
```

- 코어리스 모터에 출력을 줄 채널의 주파수를 `melody[]`내의 값으로 반복문이 돌 때마다 변환
- `ledcWrite()`의 출력은 10으로 일정한 값이지만 모터에 가진한 입력 주파수가 다르기 때문에 소리가 도레미파솔라시도로 0.5초마다 올라감을 느낄 수 있는 것임
    - 소리의 높낮이는 주파수에 따라 달라짐

```arduino
const int MOTOR_A =23;
const int MOTOR_B =19;
const int MOTOR_C =18; 
const int MOTOR_D =26;
const int CHANNEL_A =0;
const int CHANNEL_B =1;
const int CHANNEL_C =2; 
const int CHANNEL_D =3;
const int MOTOR_FREQ =5000;
const int MOTOR_RESOLUTION =10;

void setup() { 
	
	ledcAttachPin(MOTOR_A, CHANNEL_A);
	ledcAttachPin(MOTOR_B, CHANNEL_B);
	ledcAttachPin(MOTOR_C, CHANNEL_C);
	ledcAttachPin(MOTOR_D, CHANNEL_D);

	ledcSetup(CHANNEL_A, MOTOR_FREQ, MOTOR_RESOLUTION);
	ledcSetup(CHANNEL_B, MOTOR_FREQ, MOTOR_RESOLUTION);
	ledcSetup(CHANNEL_C, MOTOR_FREQ, MOTOR_RESOLUTION);
	ledcSetup(CHANNEL_D, MOTOR_FREQ, MOTOR_RESOLUTION);

	ledcWrite(CHANNEL_A, 0);
	ledcWrite(CHANNEL_B, 0);
	ledcWrite(CHANNEL_C, 0);
	ledcWrite(CHANNEL_D, 0);

	delay(5000);

}

unsigned int howMany =3;
const int throttle =130;
void loop() {

	if(howMany >0) {
		howMany --;
		
		ledcWrite(CHANNEL_A, throttle);
		ledcWrite(CHANNEL_B, 0);
		ledcWrite(CHANNEL_C, throttle);
		ledcWrite(CHANNEL_D, 0);
		delay(2000); 
		
		ledcWrite(CHANNEL_A, 0);
		ledcWrite(CHANNEL_B, 0);
		ledcWrite(CHANNEL_C, 0);
		ledcWrite(CHANNEL_D, 0);
		delay(2000); 
		
		ledcWrite(CHANNEL_A, 0);
		ledcWrite(CHANNEL_B, throttle);
		ledcWrite(CHANNEL_C, 0);
		ledcWrite(CHANNEL_D, throttle);
		delay(2000); 
		
		ledcWrite(CHANNEL_A, 0);
		ledcWrite(CHANNEL_B, 0);
		ledcWrite(CHANNEL_C, 0);
		ledcWrite(CHANNEL_D, 0);
		delay(2000); 
	} 
}
```

- 관성, 반토크로 인해 드론 프로펠러의 회전 방향에 반대로 드론 몸체가 회전하는 것을 살펴볼 수 있음
- `howMany`가 0보다 작아질 때까지 `loop()`가 4번 돎.
- `loop()`에서 출력을 대각방향의 모터에만 주므로 드론이 yawing 회전을 보여줌